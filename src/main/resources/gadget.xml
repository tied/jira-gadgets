<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs title="__MSG_gadget.title__" directory_title="__MSG_gadget.title__"
        description="__MSG_gadget.description__"
        screenshot="/images/pluginIcon.png" 
        thumbnail="/images/pluginIcon.png">
        <Optional feature="gadget-directory">
            <Param name="categories">
                JIRA
            </Param>
        </Optional>
        <Optional feature="atlassian.util" />
        <Optional feature="auth-refresh" />
        <Require feature="views" />
        <Require feature="settitle"/>
        <Require feature="oauthpopup" />
        #oauth
        <Locale messages="__ATLASSIAN_BASE_URL__/download/resources/com.trustvesta.plugins.jira.gadgets/i18n/ALL_ALL.xml"/>
        <Require feature="minimessage" />
        <Optional feature="dynamic-height" />
    </ModulePrefs>
    <UserPref name="show_date" display_name="Show Dates?" datatype="bool" default_value="true"/>

    <UserPref name="show_summ" display_name="Show Summaries?" datatype="bool" default_value="true"/>
    <UserPref name="num_entries" display_name="Number of Entries:" default_value="5"/>

    <Content type="html" view="profile">
        <![CDATA[
        #requireResource("com.atlassian.gadgets.publisher:ajs-gadgets")
        #includeResources()

        <h1>Worklog Gadget View</h1>

        <script type="text/javascript">
            (function () {
                var gadget = AJS.Gadget({
                    baseUrl: "__ATLASSIAN_BASE_URL__",
                    useOauth: "/rest/gadget/1.0/currentUser",
                    view: {
                        template: function(args) {
                            var gadget = this;

                            var projectList = AJS.$("<ul/>");

                            AJS.$(args.projectData.projects).each(function() {
                                projectList.append(
                                    AJS.$("<li/>").append(
                                        AJS.$("<a/>").attr({
                                            target: "_parent",
                                            title: gadgets.util.escapeString(this.key),
                                            href: "__ATLASSIAN_BASE_URL__" + "/browse/" + this.key
                                        }).text(this.name)        
                                    )
                                );
                            });

                            gadget.getView().html(projectList);
                        },
                        args: [{
                            key: "projectData",
                            ajaxOptions: function() {
                                return {
                                    url: "/rest/worklog-gadget/1.0/projects.json"
                                };
                            }
                        }]
                    }
                });
            })();
        </script>
        ]]>
    </Content>

 </Module>
